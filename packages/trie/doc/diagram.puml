@startuml
struct TrieReader {
  nodeStore: nodeStore
  root: VCommitment
}

struct nodeStore {
  trieStore: KVReader
  valueStore: KVReader
}

struct nodeData {
  {field} pathExtension: []byte
  terminal: TCommitment
  commitment: VCommitment
  children: [16]VCommitment
}

struct terminalCommitment {
  data: []byte
  isValue: bool
}

note right of terminalCommitment
  data is either:
  - value (if len(value) < 63)
  - hash(value)
  
  serialized as [header|data]
  where header = [isValue (1 bit) | len(data) (7 bits)]
end note

struct vectorCommitment {}

note left of vectorCommitment
  [20]byte hash
end note

package db <<Database>> {
  package valueStore <<Database>> {
  }
  package trieStore <<Database>> {
  }
}

TrieReader *-- nodeStore
TrieReader *-- vectorCommitment: root
nodeData ..> trieStore: "k=Commitment.Bytes()\nv=nodeData.Bytes()"
nodeData ..> valueStore: "(if !terminal.isValue)\nk=hash(terminal.value)\nv=terminal.value"
nodeData "1" *-- "1" terminalCommitment: Terminal
nodeData "1" *-- "1" vectorCommitment: Commitment
nodeData "1" *-- "16" vectorCommitment: Children
nodeStore ..> nodeData: creates

@enduml
